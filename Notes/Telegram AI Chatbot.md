---
tags:
- gpt
- automation
video-url: https://www.youtube.com/watch?v=ZU6llgh8nZI&list=WL&index=2
---
## **Telegram AI Chatbot

### Overview: Setting Up a Telegram AI Chatbot with n8n and Google Gemini

This guide will walk you through setting up a Telegram-based AI chatbot using **n8n** (an open-source automation platform) and **Google Gemini**. You'll deploy **n8n**, set up a **Cloudflare** tunnel, connect to Telegram, and create workflows for automated responses. Below is a detailed breakdown, including instructions and code examples.

### Tools Used

- **n8n**: Automation tool (open-source, self-hosted).
- **Google Gemini**: AI model.
- **Cloudflare**: Networking.
- **Docker**: Containerization platform.
- **Telegram Bot API**: To create and connect the bot.

### Goals

Create an interactive AI chatbot that can respond to messages on Telegram using Google Gemini. You will deploy n8n using Docker, set up Cloudflare tunnels, connect to a Telegram bot, and create workflows for automated responses.

### Step 1: Deploy n8n Using Cloudflare Tunnel

1. **Go to Cloudflare Panel**:
   - Log into Cloudflare and navigate to the **Zero Trust** section under **Networks**.
   - Click on **Tunnels** and **Create a New Tunnel**.
   - Choose **Cloudflare** and name the tunnel (e.g., `nhn PRX`).

2. **Get Token**:
   - Copy the generated token.

3. **VS Code Setup**:
   - Open **Visual Studio Code (VS Code)**.
   - Paste the token into your repository‚Äôs settings.
   - Go to **Settings > Secrets and Variables > Actions > Repository Secrets** and create a new secret named `n8n_secrets` with the token as its value.

4. **File Modifications**:
   - Make a YAML configuration file for n8n and Cloudflare.
   - Deploy changes using GitHub Actions.

### Step 2: Deploy n8n Using Docker on a Virtual Machine (VM)

1. **Setup Docker**:
   - Ensure Docker is installed on your VM.
   - If Docker is not installed, follow the installation guide linked in the description.

2. **Create Directory and Files**:
   - Create a directory named `n8n` and navigate into it:
     ```bash
     mkdir n8n
     cd n8n
     ```
   - Create a YAML deployment file and an environment file.

3. **Docker Compose Configuration**:
   - Use `docker-compose` to deploy:
     ```bash
     docker-compose -f n8n.yaml up -d
     ```
   - Define a network for n8n and Cloudflare to run inside and configure environment settings.

4. **Connect Cloudflare**:
   - In Cloudflare, create a public hostname and link it to your running Docker container (`n8n` on port `5678`).

### Step 3: Initial Setup for n8n

1. **Access n8n UI**:
   - Once deployed, access the n8n instance from the URL configured in Cloudflare.

2. **Enable Two-Factor Authentication**:
   - Since the instance is publicly accessible, enable 2FA to enhance security.

### Step 4: Creating Telegram AI Chatbot Workflow

1. **Create Telegram Bot**:
   - Open **Telegram** and search for **BotFather**.
   - Create a new bot by typing:
     ```
     /newbot
     ```
   - Provide a name (e.g., `n8n AI Chatbot`) and a username (`n8n_ai_chatbot`).
   - Copy the token generated by BotFather.

2. **Create Workflow in n8n**:
   - Create a new workflow called **Telegram AI Chatbot**.
   - Add a **Trigger**:
     - Search for **Telegram** and select **On Message**.
     - Create new credentials using the token provided by BotFather.

3. **Test Telegram Bot**:
   - Test the Telegram trigger by sending a message to the bot (`/start`).
   - Observe that n8n captures the user ID and message details.

### Step 5: Connect Workflow Steps

1. **Send Response to Telegram**:
   - Add a **Send Message** action:
     - Set credentials as configured earlier.
     - Use **Chat ID** from the previous trigger as input.
     - Configure the response to echo back user messages.
   - Test by sending ‚ÄúHi‚Äù and receiving ‚ÄúHi to you üòä‚Äù.
   - Modify to remove `n8n` attribution:
     ```yaml
     append_n8n_attribution: false
     response:
       - message: "{{ $json.message }}"
     ```

2. **Adding Google Gemini Integration**:
   - Use the **Advanced AI Agent** step.
   - Select **Google Gemini** as the chat model.
   - Create credentials using an API key from Google AI Studio:
     - Go to the documentation, click the link, and generate an API key.
     - Use **Gemini v1.5 flash** (free version).
   - Configure the prompt to use the user‚Äôs message:
     ```python
     prompt = "User Input: " + user_message
     ```

3. **Memory Configuration**:
   - If you want the chatbot to remember previous messages:
     - Use **Memory** settings and specify that the model should remember the last five messages.
   - Add a **Session ID** using the Chat ID:
     ```python
     session_id = chat_id
     ```

### Step 6: Workflow Testing

- **Test the Workflow**:
  - Use **Test Workflow** to check if the AI provides correct responses to messages like "What is LLM?".
- **Activate Workflow**:
  - Once verified, activate the workflow.

### Step 7: Exploring Templates and Use Cases

1. **Templates in n8n**:
   - Explore the templates available on the n8n website.
   - Templates include automation workflows for integrating apps like **LinkedIn**, **Notion**, and more.

2. **Additional Features**:
   - n8n has **400+ integrations** allowing you to combine various services into a powerful automated workflow.

### Code Examples and Configuration

**Docker Compose YAML Example (`n8n.yaml`)**:
```yaml
version: '3.1'

services:
  n8n:
    image: n8nio/n8n
    container_name: n8n
    ports:
      - "5678:5678"
    volumes:
      - n8n_data:/root/.n8n
    environment:
      - WEBHOOK_TUNNEL_URL=https://n8n.example.com
      - GENERIC_TIMEZONE=Europe/Berlin
    networks:
      - n8n_net

  cloudflare:
    image: cloudflare/cloudflared
    command: tunnel run --token <token>
    volumes:
      - ./cloudflare:/etc/cloudflare
    networks:
      - n8n_net

networks:
  n8n_net:
    driver: bridge

volumes:
  n8n_data:
    driver: local
```

**Telegram Bot Workflow in n8n**:
- **Trigger Node**:
  - **Node Type**: Telegram Trigger
  - **Trigger**: On Message
  - **Token**: `<Your_Telegram_Bot_Token>`
- **Response Node** (Echo Message Back):
  ```yaml
  append_n8n_attribution: false
  response:
    - message: "{{ $json.message }}"
  ```

- **AI Agent Integration (Google Gemini)**:
  ```yaml
  model: Gemini v1.5 flash
  memory: true
  memory_count: 5
  session_id: "{{ $json.chat_id }}"
  prompt: "User Message: {{ $json.message }}"
  ```

### Summary

This guide walks you through deploying a Telegram chatbot integrated with Google Gemini AI using **n8n**, **Docker**, and **Cloudflare**. You learn to:

- Deploy n8n using Docker with Cloudflare tunnels.
- Set up a Telegram bot that can respond to messages using Google Gemini.
- Automate workflows with custom logic and use AI integration.

**Key Takeaways**:
- n8n is a powerful open-source tool for automation, and integrating AI models like Google Gemini can enhance interactions.
- Deployment uses Docker and Cloudflare, ensuring a robust and secure self-hosted solution.
- The setup includes using the Telegram Bot API, Google AI API, and Docker-based infrastructure for a scalable chatbot.

This solution allows you to integrate workflows from a single interface, leveraging the power of automation and AI to create a responsive, intelligent chatbot for Telegram.

[[Chatbots]]  [[N8N Masterclass]]  [[N8N 101 Automations]]