---
tags:
- chromadb
- database
- python
---

## **ChromaDB**

ChromaDB is an open-source vector embedding database that allows users to perform semantic search. It stores documents as dense vector embeddings, typically generated by transformer-based language models, enabling nuanced semantic retrieval of documents.

## **Installation**

Start by installing the required packages:

```bash
pip install chromadb -q
pip install sentence-transformers -q
```

For demonstration purposes, we'll use a set of text files stored in a folder named "pets". Each file contains information about a different aspect of pet care.

Next, we connect to ChromaDB and create a collection. By default, ChromaDB uses the Sentence Transformers **all-MiniLM-L6-v2** model to create embeddings.

```python
import chromadb

client = chromadb.Client()
collection = client.create_collection("yt_demo")
```

### **Adding Documents**

Let's add some documents to our collection, along with corresponding metadata and unique IDs:

```python
collection.add(
    documents=["This is a document about cat", "This is a document about car"],
    metadatas=[{"category": "animal"}, {"category": "vehicle"}],
    ids=["id1", "id2"]
)
```

### **Querying**

We can now query our collection. Let's search for the term "vehicle". The result should return the document about the car.

```python
results = collection.query(
    query_texts=["vehicle"],
    n_results=1
)
print(results)
```

Output:

```python
{
    'ids': [['id2']],
    'embeddings': None,
    'documents': [['This is a document about car']],
    'metadatas': [[{'category': 'vehicle'}]],
    'distances': [[0.8069301247596741]]
}
```

### **Reading Files from a Folder**

Our output is as expected, providing the ID, document content, metadata, and distance value for the best-matching document.

Now, let's add our pet documents to the collection. Start by reading all text files from the "pets" folder and storing the data in a list.

```python
import os

def read_files_from_folder(folder_path):
    file_data = []

    for file_name in os.listdir(folder_path):
        if file_name.endswith(".txt"):
            with open(os.path.join(folder_path, file_name), 'r') as file:
                content = file.read()
                file_data.append({"file_name": file_name, "content": content})

    return file_data

folder_path = "pets"
file_data = read_files_from_folder(folder_path)
```

### **Adding File Contents to ChromaDB**

We create separate lists for documents, metadata, and IDs, and then add them to our collection:

```python
documents = []
metadatas = []
ids = []

for index, data in enumerate(file_data):
    documents.append(data['content'])
    metadatas.append({'source': data['file_name']})
    ids.append(str(index + 1))

pet_collection = client.create_collection("pet_collection")

pet_collection.add(
    documents=documents,
    metadatas=metadatas,
    ids=ids
)
```

## **Performing Semantic Searches**

Let's now query the collection for information about different kinds of pets people commonly own:

```python
results = pet_collection.query(
    query_texts=["What are the different kinds of pets people commonly own?"],
    n_results=1
)
print(results)
```

Output:

```python
{
    'ids': [['1']],
    'embeddings': None,
    'documents': [['Pet animals come in all shapes and sizes, each suited to different lifestyles and home environments. Dogs and cats are the most common, known for their companionship and unique personalities. Small mammals like hamsters, guinea pigs, and rabbits are often chosen for their low maintenance needs. Birds offer beauty and song, and reptiles like turtles and lizards can make intriguing pets. Even fish, with their calming presence, can be wonderful pets.']],
    'metadatas': [[{'source': 'Different Types of Pet Animals.txt'}]],
    'distances': [[0.7325009703636169]]
}
```

The query successfully retrieves the most relevant document, which talks about different types of pet animals.

### **Filtering Results**

You can refine your search using the `where_document` parameter to specify conditions for the document text. For instance, to find documents about the emotional benefits of owning a pet that mention reptiles:

```python
results = pet_collection.query(
    query_texts=["What are the emotional benefits of owning a pet?"],
    n_results=1,
    where_document={"$contains": "reptiles"}
)
print(results)
```

Similarly, if you want to use metadata to filter your search results, use the `where` parameter. To find information specifically from the document about pet training and behavior:

```python
results = pet_collection.query(
    query_texts=["What are the emotional benefits of owning a pet?"],
    n_results=1,
    where={"source": "Training and Behaviour of Pets.txt"}
)
print(results)
```

## **Using a Different Model for Embedding**

While ChromaDB uses the Sentence Transformers **all-MiniLM-L6-v2** model by default, you can use any other model for creating embeddings. In this example, we'll use the **paraphrase-MiniLM-L3-v2** model from Sentence Transformers.

First, load the model and create embeddings for your documents:

```python
from sentence_transformers import SentenceTransformer

model = SentenceTransformer('paraphrase-MiniLM-L3-v2')

documents = []
embeddings = []
metadatas = []
ids = []

for index, data in enumerate(file_data):
    documents.append(data['content'])
    embedding = model.encode(data['content']).tolist()
    embeddings.append(embedding)
    metadatas.append({'source': data['file_name']})
    ids.append(str(index + 1))
```

Create a new collection and add the documents, embeddings, metadata, and IDs:

```python
pet_collection_emb = client.create_collection("pet_collection_emb")

pet_collection_emb.add(
    documents=documents,
    embeddings=embeddings,
    metadatas=metadatas,
    ids=ids
)
```

To perform a query, provide the embedding of the query text:

```python
query = "What are the different kinds of pets people commonly own?"
input_em = model.encode(query).tolist()

results = pet_collection_emb.query(
    query_embeddings=[input_em],
    n_results=1
)
print(results)
```

Finally, letâ€™s make a specific query about recommended foods for dogs:

```python
query = "foods that are recommended for dogs?"
input_em = model.encode(query).tolist()

results = pet_collection_emb.query(
    query_embeddings=[input_em],
    n_results=1
)
print(results)
```

The result should correctly provide the document about the nutrition needs of pet animals.

---

[[Vector Databases]]   [[Python]]
